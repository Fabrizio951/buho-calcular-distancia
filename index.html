<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Calculadora de Distancias</title>
    <script src="node_modules/jquery/dist/jquery.js"></script>


    node_modules\jquery\dist
</head>
<body>

    <div class="container" id="ocultar">
        <div class="input-section">
            <h2>Ingrese los puntos de partida y llegada:</h2>
            <label for="startPoint">Punto de Partida:</label>
            <input type="text" id="startPoint" placeholder="Ingrese punto de partida">

            <label for="endPoint">Punto de Llegada:</label>
            <input type="text" id="endPoint" placeholder="Ingrese punto de llegada">

            <button onclick="calcularDistancia()">Calcular Distancia</button>
        </div>

        <div class="options-section">
            <h2>Opciones de Servicio:</h2>
            <div class="service-option" id="economicOption">
                <h3>Económico</h3>
                <p>Precio por metro: S/ 0.5</p>
                <p>Total: <span id="economicTotal">0.00</span></p>
                <button type="button" onclick="hacerFormulario()">Seleccionar Económico</button>
            </div>

            <div class="service-option" id="executiveOption">
                <h3>Executive</h3>
                <p>Precio por metro: S/ 1.5</p>
                <p>Total: <span id="executiveTotal">0.00</span></p>
                <button type="button" onclick="hacerFormulario()">Seleccionar Executive</button>
            </div>
        </div>
    </div>

     <!-- Formulario -->
     <div id="formulario" class="container" style="display: none;">
        <h2>Formulario</h2>
        <form>

            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>

            <label for="correo">Correo:</label>
            <input type="email" id="correo" name="correo" required>

            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" name="telefono" required>

            <button type="button" onclick="aceptarFormulario()">Aceptar</button>
        </form>
    </div>  
    <script>    
        function enviarMensajeWhatsApp() {
            // Realiza una llamada AJAX al archivo PHP
            $.ajax({
                type: 'POST',
                url: 'enviar_whatsapp.php',
                data: {
                    // Puedes pasar datos adicionales si es necesario
                },
                success: function(response) {
                    // Maneja la respuesta (puede mostrar un mensaje de éxito o manejar errores)
                    console.log(response);
                },
                error: function(error) {
                    // Maneja cualquier error en la llamada AJAX
                    console.error('Error:', error);
                }
            });
        }
        
        function ocultarMostrar() {
            document.getElementById('ocultar').style.display = 'none';
            document.getElementById('formulario').style.display = 'block';
        }

        function hacerFormulario() {
            ocultarMostrar();
        }

        function aceptarFormulario(){
            alert('Formulario aceptado');
        }

    </script>
    <script>
        //Función para obtener coordenadas del inicio y final 
        function geocodeAddress(address, callback) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({ 'address': address }, function (results, status) {
                if (status === 'OK') {
                    var coordinates = {
                        lat: results[0].geometry.location.lat(),
                        lng: results[0].geometry.location.lng()
                    };
                    callback(coordinates);
                } else {
                    window.alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }
    </script>

    <script>
        function calcularDistancia() {
            // Obtener las ubicaciones a partir de las direcciones ingresadas por el usuario
            var startAddress = document.getElementById('startPoint').value;
            var endAddress = document.getElementById('endPoint').value;

            // Convertir direcciones en coordenadas
            geocodeAddress(startAddress, function(partida) {
                geocodeAddress(endAddress, function(llegada) {
                    // Ahora tienes las coordenadas de partida y llegada, puedes continuar con el cálculo de distancia
                    // y la actualización de precios.
                    console.log("Coordenadas de Partida:", partida);
                    console.log("Coordenadas de Llegada:", llegada);

                    //Ruta
                    let directionsService = new google.maps.DirectionsService();
                    let directionsRenderer = new google.maps.DirectionsRenderer();

                    // Create route from existing points used for markers
                    const route = {
                        origin: partida,
                        destination: llegada,
                        travelMode: 'DRIVING'
                    }

                    directionsService.route(route, function(response, status) {
                        // anonymous function to capture directions
                        if (status !== 'OK') {
                            window.alert('Directions request failed due to ' + status);
                            return;
                        } else {
                            directionsRenderer.setDirections(response); // Add route to the map
                            var directionsData = response.routes[0].legs[0]; // Get data about the mapped route
                            if (!directionsData) {
                                window.alert('Directions request failed');
                                return;
                            } else {
                                // Supongamos que la distancia se almacena en la variable 'distanciaEnKm'
                                var distanciaEnKm = parseFloat(directionsData.distance.text.replace(" mi", "")) * 1.60934;

                                // Actualizar el precio en función de la distancia
                                var precioEconomico = distanciaEnKm * 0.5;
                                var precioExecutive = distanciaEnKm * 1.5;

                                // Actualizar los elementos HTML con los nuevos precios
                                document.getElementById('economicTotal').innerText = precioEconomico.toFixed(2);
                                document.getElementById('executiveTotal').innerText = precioExecutive.toFixed(2);
                            }
                        }
                    });
                });
            });
        }
    </script>
    <!--API KEY GOOGLE MAPS-->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js=initMap">
    </script>
    
</body>
</html>
